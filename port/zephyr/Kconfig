# Copyright (c) 2024 Hubble Network, Inc.
# SPDX-License-Identifier: Apache-2.0

module = HUBBLE
module-str = HubbleNetwork
source "subsys/logging/Kconfig.template.log_config"

choice HUBBLE_EID_MODE
	prompt "EID generation mode"
	default HUBBLE_EID_UTC_BASED

config HUBBLE_EID_UTC_BASED
	bool "UTC-based EID generation"
	help
	  EID derived from UTC time. Requires time provisioning.

config HUBBLE_EID_COUNTER_BASED
	bool "Counter-based EID generation"
	help
	  EID derived from internal counter. No UTC time required.
	  Initial counter value provided via hubble_init().

endchoice

config HUBBLE_EID_ROTATION_PERIOD_SEC
	int "EID rotation period in seconds"
	default 86400
	range 86400 86400
	help
	  EID rotation period. Currently only daily rotations
	  are supported (86400)

config HUBBLE_EID_POOL_SIZE
	int "EID pool size"
	default 64
	range 16 2048
	depends on HUBBLE_EID_COUNTER_BASED
	help
	  Number of unique EIDs in the pool. The counter wraps at this value.
	  Range: 16 to 2048 unique EID epochs.

	  Examples with default rotation period (86400 sec / daily):
	    16:   ~16 days of unique EIDs
	    64:   ~64 days of unique EIDs (default)
	    256:  ~256 days of unique EIDs
	    2048: ~5.6 years of unique EIDs

config HUBBLE_SAT_NETWORK
	   bool "Hubble Satellite Network Library [EXPERIMENTAL]"
	   select EXPERIMENTAL
	   select ENTROPY_GENERATOR
	   help
		Enable library for communication with Hubble network

if HUBBLE_SAT_NETWORK

config HUBBLE_SAT_NETWORK_SMALL
	   bool "Use smaller code size for fly by calculation"
	   help
		Reduces code using polynomial approximation
		for trigonometric functions

config HUBBLE_SAT_NETWORK_DEVICE_TDR
	   int "Device time drift retry rate in PPM"
	   default 500
	   help
		Adds additional retries proportional to time since
		last time the device had utc time synced. It is
		represented in PPM (parts per million).

choice
	prompt "Hubble Sat Network protocol"
	default HUBBLE_SAT_NETWORK_PROTOCOL_V1

config HUBBLE_SAT_NETWORK_PROTOCOL_V1
	   bool "Use V1 protocol"
	   help
		First version of Sat protocol. Channel hopping within transmissions.

config HUBBLE_SAT_NETWORK_PROTOCOL_DEPRECATED
	   bool "Use deprecated protocol"
	   select DEPRECATED
	   help
		Deprecated version of Sat protocol. No channel hopping during transmissions.
endchoice

endif

menuconfig HUBBLE_BLE_NETWORK
	   bool "Hubble BLE Network Library"
	   help
		Enable library for communication with Hubble BLE network

choice
	prompt "Hubble Network key size"

config HUBBLE_NETWORK_KEY_256
	   bool "Use 256 bits key size"
	   help
		256 bits key size

config HUBBLE_NETWORK_KEY_128
	   bool "Use 128 bits key size"
	   help
		128 bits key size

endchoice

config HUBBLE_KEY_SIZE
	   int
	   default 32 if HUBBLE_NETWORK_KEY_256
	   default 16 if HUBBLE_NETWORK_KEY_128

config HUBBLE_NETWORK_SECURITY_ENFORCE_NONCE_CHECK
	   bool "Enforce check in nonce used in cryptography"
	   default y
	   help
		Ensure that nonce parameters are not re-used
		to encrypt different messages.
		Be aware that re-using the same nonce has severe
		security implications.

config HUBBLE_NETWORK_SEQUENCE_NONCE_CUSTOM
	   bool "Application defined implementation"
	   help
		This option allows applications to override the default
		function that returns a sequence number to be used to
		encrypt messages.

choice
	prompt "HUBBLE BLE Network crypto provider"
	default HUBBLE_BLE_NETWORK_PSA

config HUBBLE_BLE_NETWORK_MBEDTLS
	   bool "Use MBEDTLS for Hubble BLE Network Library"
	   depends on !NRF_SECURITY
	   select MBEDTLS
	   select MBEDTLS_CMAC
	   select MBEDTLS_CIPHER
	   select MBEDTLS_CIPHER_AES_ENABLED
	   select MBEDTLS_CIPHER_MODE_CTR_ENABLED
	   help
		Enable library for communication with Hubble BLE network

config HUBBLE_BLE_NETWORK_PSA
	   bool "Use PSA Crypto for Hubble BLE Network Library"
	   select MBEDTLS
	   select MBEDTLS_PSA_CRYPTO_C if !BUILD_WITH_TFM
	   select PSA_WANT_KEY_TYPE_AES
	   select PSA_WANT_ALG_CMAC
	   select PSA_WANT_ALG_CTR
	   help
		Enable library for communication with Hubble BLE network

config HUBBLE_BLE_NETWORK_CUSTOM_CRYPTO
	   bool "Custom crypto implementation"
	   help
	    Custom cryptography implementation. The target
	    will implement all crypto interfaces.

endchoice

if HUBBLE_BLE_NETWORK

# DEPRECATED: Use HUBBLE_EID_ROTATION_PERIOD_SEC instead
# Kept for backward compatibility
config HUBBLE_BLE_NETWORK_TIMER_COUNTER_DAILY
	bool "Timer counter changes daily (DEPRECATED)"
	default n
	select DEPRECATED
	help
	  DEPRECATED: Use HUBBLE_EID_ROTATION_PERIOD_SEC instead.
	  This option is maintained for backward compatibility only.

endif

menu "Logging"

endmenu
